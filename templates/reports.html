{% extends "base.html" %}
{% block content %}
  <h2>Submit Report - {{ facility.name }}</h2>
  <form method="post">
    <table border="1" cellpadding="5">
      <thead>
        <tr>
          <th>Commodity</th>
          <th>Opening Balance</th>
          <th>Quantity Received</th>
          <th>Quantity Used</th>
          <th>New Balance</th>
          <th>Expiry Date</th>
        </tr>
      </thead>
      <tbody>
        {% for commodity in commodities %}
        <tr>
          <td>{{ commodity.name }}</td>
          <td>
            <input type="number" name="opening_balance_{{ commodity.id }}" value="{{ commodity.opening_balance }}" readonly>
          </td>
          <td>
            <input type="number" name="quantity_received_{{ commodity.id }}" value="0" min="0" oninput="updateBalance({{ commodity.id }})">
          </td>
          <td>
            <input type="number" name="quantity_used_{{ commodity.id }}" value="0" min="0" oninput="updateBalance({{ commodity.id }})">
          </td>
          <td>
            <input type="number" name="balance_{{ commodity.id }}" value="{{ commodity.opening_balance }}" readonly>
          </td>
          <td>
            <input type="date" name="expiry_date_{{ commodity.id }}" required>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <br>
    <button type="submit">Submit Report</button>
  </form>

  <script>
    function updateBalance(id) {
      let opening = parseInt(document.getElementsByName('opening_balance_' + id)[0].value) || 0;
      let received = parseInt(document.getElementsByName('quantity_received_' + id)[0].value) || 0;
      let used = parseInt(document.getElementsByName('quantity_used_' + id)[0].value) || 0;
      let newBalance = opening + received - used;
      document.getElementsByName('balance_' + id)[0].value = newBalance >= 0 ? newBalance : 0;
    }
  </script>
{% endblock %}
